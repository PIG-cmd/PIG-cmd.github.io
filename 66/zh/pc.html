<title>班费缴纳系统</title>
<pre>
<meta charset="utf-8">
<img src=https://api.dujin.org/bing/1920.php height=100% width=100% style='position:fixed;top:0px;left:0px;z-index:-1'>
<center>
<div style='background:skyblue'><font color=red>班费缴纳系统</font><br><div id=status>正在连接数据库......(DataBase:Number Table:Number)</div><div id=result></div></div>
</center>
<script>
var xhr;
var db;
setTimeout(function(){
db = new Object();
if (window.XMLHttpRequest)
{
	xhr = new XMLHttpRequest();
} else {
	xhr = new ActiveXObject("Microsoft.XMLHTTP");
}
xhr.open("GET","../number.txt",false);
xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xhr.send();
document.getElementById("status").innerHTML = "正在等待数据库响应......(DataBase:Number Table:Number)";
setTimeout(function(){
if (xhr.readyState == 4 && xhr.status == 200)
{
	db.number = xhr.responseText;
	db.number = unescape(db.number);
	sessionStorage.setItem("num",db.number);
	document.getElementById("status").innerHTML = "请键入您的学号<input type=text id=number placeholder=学号><input type=button value=查询 onclick=javascript:search();>";
} else {
	document.getElementById("status").innerHTML = "数据库响应错误：TCP/IP状态：" + xhr.readyState + "| HTTP状态：" + xhr.status + "| DataBase:Number Table:Number";
}
},1000);
},500);
</script>
<script>
function search()
{
	var number = document.getElementById("number").value;
	document.getElementById("result").innerHTML = "";
	console.log(number);
	document.getElementById("status").innerHTML = "正在连接数据库......(DateBase:Money Table:Money)";
	var db;
	db = new Object();
	db.number = number;
	setTimeout(function(){

		if (window.XMLHttpRequest)
		{
			xhr = new XMLHttpRequest();
		} else {
			xhr = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xhr.open("GET","../money.txt",false);
		xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		xhr.send();
		document.getElementById("status").innerHTML = "正在等待数据库响应......(DateBase:Money Table:Money)";
		setTimeout(function(){
		if (xhr.readyState == 4 && xhr.status == 200)
		{
			db.money = JSON.parse(unescape(xhr.responseText));
			loadmoney(db);
			} else {
				document.getElementById("status").innerHTML = "数据库响应错误：TCP/IP状态：" + xhr.readyState + "| HTTP状态：" + xhr.status + "| DataBase:Money Table:Money";
}
},2000);
},1000);
}
	
</script>
<script>
function loadmoney(db)
{
	console.log(db);
	document.getElementById("status").innerHTML = "";
	document.getElementById("result").innerHTML = "请键入您的学号：<input type=text id=number placeholder=学号 value=" + db.number + "><input type=button value=查询 onclick=javascript:search();>";
	var r = document.getElementById("result");
	db.num = JSON.parse(sessionStorage.getItem("num"));
	var name = db.num[db.number];
	if (typeof name == "undefined")
		r.innerHTML += "<br>找不到对象 " + db.number + "<br>DataBase:Number Table:Number";
	else
	{

		var obj = db.money[db.number];
		document.getElementById("result").innerHTML += "<br><font color=red>" + name + "</font>您好！<br>截止至<font color=red>" + db.money.date + "</font><br>您已累计上缴<font color=red>" + obj.donate + "</font>人民币<br>账户中有<font color=red>" + obj.star + "颗</font>星 | <font color=red>" + obj.dot + "个</font>点<br>";
		obj.canstar = parseInt(obj.dot) % 5;
		obj.star = parseInt(obj.star);
		if (obj.star < obj.canstar)
			obj.canstar = obj.star;
		obj.updot = parseInt(obj.dot) - obj.canstar;
		document.getElementById("result").innerHTML += "您可以使用<font color=red>" + obj.canstar + "</font>个星来抵消您的点<br>您需要上缴<font color=red>" + (obj.updot * 2)+ "</font>人民币给班级<br>支持微信转账<br>[二维码收款升级中，暂不开放]<br>向<font color=red>徐亦辰</font>转账";
		var i = 1;
		var add = 300;
		while (i != 36)
		{
			add += parseInt(db.money[i].donate);
			i++;
		}
		if (add == 0)
			add = 1;
		var donatepercent = parseInt(obj.donate) / add * 100;
		r.innerHTML += "<br>您为班级作出的贡献占到全部的<font color=red>" + donatepercent.toFixed(2) + "%</font>";

	}
}
</script>
<div id=copyright style='position:fixed;bottom:0px;right:0%;background:skyblue'>
<center><pre>联系方式 李沪纲 <a href=mailto:fat-pig-2020@outlook.com>fat-pig-2020@outlook.com</a> 徐亦辰 <a href=mailto:xyc_35@163.com>xyc_35@163.com</a>
<hr><br>版权所有 ©2021 班费缴纳系统
</div>
